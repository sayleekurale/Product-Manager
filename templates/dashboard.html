{% extends "base.html" %}
{% block content %}
<h3 class="mb-4">Dashboard</h3>

<div class="row g-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Social Posts Summary</div>
      <div class="card-body">
        <canvas id="postsSummaryChart" height="120"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">Bitcoin Price (24h)</div>
      <div class="card-body">
        <canvas id="btcChart" height="120"></canvas>
      </div>
    </div>
  </div>
  </div>

<script>
async function loadPostsSummary() {
  const res = await fetch('/api/reports/posts_summary/');
  const data = await res.json();
  const count = data.count || 0;
  const avgLen = data.avg_length || 0;

  const ctx = document.getElementById('postsSummaryChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Count', 'Avg Length'],
      datasets: [{
        label: 'Posts',
        data: [count, Math.round(avgLen)],
        backgroundColor: ['#0d6efd', '#6c757d']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
  });
}

async function loadBTC() {
  const res = await fetch('/api/external/coin_prices/');
  const data = await res.json();
  const prices = (data.prices || []).map(p => ({ t: new Date(p[0]), y: p[1]}));

  const ctx = document.getElementById('btcChart');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: prices.map(p => p.t.toLocaleTimeString()),
      datasets: [{
        label: 'BTC (USD)',
        data: prices.map(p => p.y),
        borderColor: '#198754',
        tension: 0.2
      }]
    },
    options: { responsive: true }
  });
}

loadPostsSummary();
loadBTC();
</script>
{% endblock %}


